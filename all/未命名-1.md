```mermaid
graph TD
%% 总流程
A[原始数据集] --> B[数据清洗与预处理]
B --> C[特征工程]
C --> D[样本均衡化]
D --> E[基学习器训练]
E --> F[Stacking集成模型]
F --> G[模型优化]
G --> H[验证与评估]
H --> I[结果应用]

%% 数据清洗与预处理
subgraph B [数据清洗与预处理]
  B1[删除冗余特征] -->|剔除ID字段| B2[缺失值检测]
  B2 -->|无缺失值| B3[异常值处理]
  B3 -->|Z-Score法<br>|z= (x-μ)/σ| B4[数值型特征标准化]
  B4 -->|Min-Max归一化| B5[预处理完成数据]
end

%% 特征工程
subgraph C [特征工程]
  C1[类别型特征处理] --> C1a[One-Hot编码]
  C1a -->|婚姻/车辆/住房| C1b[目标编码]
  C1b -->|职业/城市/州| C2[数值型特征处理]
  
  C2 --> C2a[构造工作稳定性特征]
  C2a -->|Job_Experience_Ratio=当前工作年限/(总经验+1)| C2b[构造住所稳定性特征]
  C2b -->|House_Job_Stability=居住年限-工作年限| C2c[构造收入稳定性特征]
  C2c -->|Income_per_Experience=收入/(经验+1)| C3[特征重要性分析]
  C3 -->|随机森林评估| C4[特征选择]
end

%% 样本均衡化
subgraph D [样本均衡化]
  D1[SMOTE过采样] -->|生成合成样本| D2[自适应欠采样]
  D2 --> D2a[五折交叉验证]
  D2a -->|预测概率>0.9且正确| D2b[标记简单样本]
  D2b -->|剔除50%简单样本| D3[平衡训练集]
end

%% 基学习器训练
subgraph E [基学习器训练]
  E1[XGBoost] --> E1a[网格搜索调参]
  E1a -->|max_depth=5, learning_rate=0.1| E1b[五折交叉验证]
  
  E2[随机森林] --> E2a[特征重要性筛选]
  E2a -->|n_estimators=200| E2b[OOB评估]
  
  E3[LightGBM] --> E3a[直方图分箱]
  E3a -->|num_leaves=31| E3b[叶子生长优化]
end

%% Stacking集成
subgraph F [Stacking集成模型]
  F1[第一层基学习器] --> F1a[XGBoost概率输出]
  F1 --> F1b[随机森林概率输出]
  F1 --> F1c[LightGBM概率输出]
  
  F1a & F1b & F1c --> F2[元特征矩阵构建]
  F2 --> F3[第二层元学习器]
  F3 -->|逻辑回归| F4[初步预测概率]
end

%% 模型优化
subgraph G [模型优化]
  G1[自适应欠采样增强] --> G1a[保留边界样本]
  G1a -->|预测概率0.4-0.6| G1b[重新训练基学习器]
  
  G2[分段加权融合] --> G2a[低风险区间(0-0.3)]
  G2a -->|原始模型权重70%| G2b[中风险区间(0.3-0.7)]
  G2b -->|动态调整权重| G2c[高风险区间(0.7-1)]
  G2c -->|欠采样模型权重80%| G3[最终预测概率公式]
  G3 -->|P_final=Σ(w_i*p_i)| G4[优化后模型]
end

%% 验证与评估
subgraph H [验证与评估]
  H1[数据集划分] --> H1a[训练集60%]
  H1 --> H1b[验证集20%]
  H1 --> H1c[测试集20%]
  
  H2[评估指标] --> H2a[AUC-ROC曲线]
  H2 --> H2b[召回率76.62%→77.64%]
  H2 --> H2c[F1-Score提升2.1%]
  H2 --> H2d[KS值0.512→0.529]
  
  H3[对比实验] --> H3a[单一模型对比]
  H3a -->|XGBoost AUC 0.927| H3b[改进Stacking AUC 0.9366]
  H3 --> H3c[采样策略对比]
  H3c -->|SMOTE vs 自适应欠采样| H3d[召回率提升1.3%]
end

%% 结果应用
subgraph I [结果应用]
  I1[风险等级可视化] --> I1a[低/中/高风险区间划分]
  I2[预警系统设计] --> I2a[动态阈值调整]
  I3[模型部署] --> I3a[API服务化]
end

```